{"version":3,"file":"ractive-tab-box.js","sources":["../src/index.js"],"sourcesContent":["/* global Ractive */\n\n// TODO: draggable tab arrangement\n\nvar template = `<div class=\"ractive-tab-box\">\n  <div class=\"rtb-tabs{{#if ~/fillWidth}} fill-width{{/if}}\">\n    {{#tabs:i}}\n      <div class=\"rtb-tab{{#current === i}} selected{{/}}\" on-click=\"changeTab(i)\">\n        <div>{{>~/tab(i, 'title')}}</div>{{#.closable}} <button on-click=\"closeTab(i)\" />{{/}}\n      </div>\n    {{/}}\n  </div>\n  <div class=\"rtb-contents\">\n    {{#tabs:i}}\n      <div style=\"{{#current !== i}}position: absolute; left: -10000px; top: -10000px; height: 100%;{{/}}\" {{#.class}}class=\"{{.class}}\"{{/}}>{{>~/tab(i)}}</div>\n    {{/}}\n  </div>\n</div>`;\n\n// get the {content,title} of a tab\nfunction tab(index, part) {\n  if (part === undefined) part = 'content';\n\n  let tb = this.get('tabs')[index];\n\n  if (!tb) return 'missing';\n\n  var key = part + '-' + tb.id;\n  if (key in this.partials) return key;\n\n  this.partials[key] = tb[part] || 'Tab ' + index;\n\n  return key;\n}\n\nvar TabBox = Ractive.extend({\n  template: template,\n  onconstruct(opts) {\n    var tabs = opts.data.tabs = [];\n\n    // read tabs from content\n    var content = opts.partials.content, c;\n    if (content) {\n      for (var i = 0; i < content.length && (c = content[i]); i++) {\n        if (c.e === 'Tab') {\n          c.a = c.a || {};\n          let tab = {};\n\n          for (let k in c.a) tab[k] = c.a[k];\n\n          tab.closable = !!c.a.closable && !!c.a.closable.toString().match(/^t/i);\n          tab.content = c.f;\n          tab.id = getId();\n          tabs.push(tab);\n        }\n      }\n    }\n\n    // set current to the first tab\n    opts.data.current = 0;\n  },\n  data() {\n    return {\n      tab, fillWidth: false\n    };\n  },\n\n  partials: { 'missing': '' },\n\n  // switch tabs by index\n  changeTab(index) {\n    return this.set('current', index);\n  },\n\n  // close tab by index\n  closeTab(index) {\n    var me = this, tab = me.get('tabs')[index];\n\n    if (tab !== undefined) {\n      var id = tab.id;\n      if ((typeof tab.onClose === 'function' && tab.onClose.call(this)) || typeof tab.onClose !== 'function') {\n        delete this.partials['title-' + id];\n        delete this.partials['content-' + id];\n        return me.splice('tabs', index, 1).then(() => me.set('current', index > 0 ? index - 1 : 0));\n      }\n    }\n  },\n\n  // add a tab to the end\n  appendTab(options) {\n    this.insertTab(-1, options);\n  },\n\n  // add a tab at index\n  insertTab(index, options) {\n    var me = this, tabs = this.get('tabs');\n    if (index < 0) index = tabs.length;\n    options.id = getId();\n    return me.splice('tabs', index, 0, options).then(() => me.set('current', index));\n  },\n\n  // reset tab content\n  resetTab(index, content) {\n    var tab = this.get('tabs')[index];\n\n    if (tab) {\n      return me.resetPartial('content-' + tab.id, content);\n    }\n  },\n\n  // reset tab title\n  resetTitle(index, title) {\n    var tab = this.get('tabs')[index];\n\n    if (tab) {\n      return me.resetPartial('title-' + tab.id, title);\n    }\n  }\n});\n\n// module level tab ids\nvar getId = (function() {\n  var i = 0;\n  return function getId() {\n    return i++;\n  };\n})();\n\nexport default TabBox;\n"],"names":[],"mappings":"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"}