{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["/* global Ractive */\n\n// TODO: draggable tab arrangement\n\nvar template = `<div class=\"ractive-tab-box\">\n  <div class=\"rtb-tabs{{#if ~/fillWidth}} fill-width{{/if}}\">\n    {{#tabs:i}}\n      <div class=\"rtb-tab{{#current === i}} selected{{/}}\" on-click=\"changeTab(i)\">\n        <div>{{>~/tab(i, 'title')}}</div>{{#.closable}} <button on-click=\"closeTab(i)\" />{{/}}\n      </div>\n    {{/}}\n  </div>\n  <div class=\"rtb-contents\">\n    {{#tabs:i}}\n      <div style=\"{{#current !== i}}position: absolute; left: -10000px; top: -10000px; height: 100%;{{/}}\" {{#.class}}class=\"{{.class}}\"{{/}}>{{>~/tab(i)}}</div>\n    {{/}}\n  </div>\n</div>`;\n\n// get the {content,title} of a tab\nfunction tab(index, part) {\n  if (part === undefined) part = 'content';\n\n  let tb = this.get('tabs')[index];\n\n  if (!tb) return 'missing';\n\n  var key = part + '-' + tb.id;\n  if (key in this.partials) return key;\n\n  this.partials[key] = tb[part] || 'Tab ' + index;\n\n  return key;\n}\n\nvar TabBox = Ractive.extend({\n  template: template,\n  onconstruct(opts) {\n    var tabs = opts.data.tabs = [];\n\n    // read tabs from content\n    var content = opts.partials.content, c;\n    if (content) {\n      for (var i = 0; i < content.length && (c = content[i]); i++) {\n        if (c.e === 'Tab') {\n          c.a = c.a || {};\n          let tab = {};\n\n          for (let k in c.a) tab[k] = c.a[k];\n\n          tab.closable = !!c.a.closable && !!c.a.closable.toString().match(/^t/i);\n          tab.content = c.f;\n          tab.id = getId();\n          tabs.push(tab);\n        }\n      }\n    }\n\n    // set current to the first tab\n    opts.data.current = 0;\n  },\n  data() {\n    return {\n      tab, fillWidth: false\n    };\n  },\n\n  partials: { 'missing': '' },\n\n  // switch tabs by index\n  changeTab(index) {\n    return this.set('current', index);\n  },\n\n  // close tab by index\n  closeTab(index) {\n    var me = this, tab = me.get('tabs')[index];\n\n    if (tab !== undefined) {\n      var id = tab.id;\n      if ((typeof tab.onClose === 'function' && tab.onClose.call(this)) || typeof tab.onClose !== 'function') {\n        delete this.partials['title-' + id];\n        delete this.partials['content-' + id];\n        return me.splice('tabs', index, 1).then(() => me.set('current', index > 0 ? index - 1 : 0));\n      }\n    }\n  },\n\n  // add a tab to the end\n  appendTab(options) {\n    this.insertTab(-1, options);\n  },\n\n  // add a tab at index\n  insertTab(index, options) {\n    var me = this, tabs = this.get('tabs');\n    if (index < 0) index = tabs.length;\n    options.id = getId();\n    return me.splice('tabs', index, 0, options).then(() => me.set('current', index));\n  },\n\n  // reset tab content\n  resetTab(index, content) {\n    var tab = this.get('tabs')[index];\n\n    if (tab) {\n      return me.resetPartial('content-' + tab.id, content);\n    }\n  },\n\n  // reset tab title\n  resetTitle(index, title) {\n    var tab = this.get('tabs')[index];\n\n    if (tab) {\n      return me.resetPartial('title-' + tab.id, title);\n    }\n  }\n});\n\n// module level tab ids\nvar getId = (function() {\n  var i = 0;\n  return function getId() {\n    return i++;\n  };\n})();\n\nexport default TabBox;\n"],"names":[],"mappings":"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"}